{% load wheel_filters %}
{% load humanize %}

<div>
    <div class="mb-6">
        <h2 class="text-2xl font-bold text-gray-900">üìä Weekly Wheel Options Chain</h2>
        <p class="text-gray-600 mt-1">Find the best 7-14 DTE cash-secured put opportunities</p>
    </div>

    <!-- Ticker Selector -->
    <div class="bg-white rounded-lg border border-gray-200 p-4 mb-4">
        <form method="get" action="{% url 'ibkr:hub' %}" class="grid grid-cols-1 md:grid-cols-5 gap-3 items-end">
            <input type="hidden" name="tab" value="discovery">
            <input type="hidden" name="subtab" value="options">
            
            <div class="md:col-span-2">
                <label class="block text-xs font-semibold text-gray-700 mb-1">Select Stock</label>
                <select name="ticker" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                    <option value="">Choose a stock...</option>
                    {% for s in available_stocks %}
                    <option value="{{ s.ticker }}" {% if s.ticker == selected_ticker %}selected{% endif %}>
                        {{ s.ticker }} - ${{ s.last_price|floatformat:2 }}{% if s.indicators.rsi %} | RSI {{ s.indicators.rsi|floatformat:0 }}{% endif %}
                    </option>
                    {% endfor %}
                </select>
            </div>
            
            <div>
                <label class="block text-xs font-semibold text-gray-700 mb-1">DTE Range</label>
                <select name="dte_filter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                    <option value="all" {% if request.GET.dte_filter == 'all' %}selected{% endif %}>All Expirations</option>
                    <option value="weekly" {% if request.GET.dte_filter == 'weekly' or not request.GET.dte_filter %}selected{% endif %}>‚≠ê Weekly (7-14 DTE)</option>
                    <option value="monthly" {% if request.GET.dte_filter == 'monthly' %}selected{% endif %}>Monthly (30-45 DTE)</option>
                    <option value="short" {% if request.GET.dte_filter == 'short' %}selected{% endif %}>< 7 Days</option>
                </select>
            </div>
            
            <div>
                <label class="block text-xs font-semibold text-gray-700 mb-1">Min APY</label>
                <select name="min_apy" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                    <option value="0" {% if request.GET.min_apy == '0' or not request.GET.min_apy %}selected{% endif %}>Any APY</option>
                    <option value="20" {% if request.GET.min_apy == '20' %}selected{% endif %}>‚â• 20%</option>
                    <option value="30" {% if request.GET.min_apy == '30' %}selected{% endif %}>‚â• 30%</option>
                    <option value="50" {% if request.GET.min_apy == '50' %}selected{% endif %}>‚â• 50%</option>
                </select>
            </div>
            
            <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold">
                üîç Filter
            </button>
        </form>
    </div>

    {% if selected_stock %}
    <!-- Stock Info Card -->
    <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg border border-blue-200 p-6 mb-4">
        <div class="flex justify-between items-start">
            <div class="flex-1">
                <div class="flex items-center gap-3 mb-2">
                    <h3 class="text-2xl font-bold text-gray-900">{{ selected_stock.ticker }}</h3>
                    <span class="text-lg text-gray-600">{{ selected_stock.name }}</span>
                </div>
                
                <!-- Weekly Wheel Signal -->
                {% if selected_stock.indicators.rsi %}
                <div class="inline-flex items-center gap-2 px-3 py-1.5 rounded-lg {% if selected_stock.indicators.rsi < 35 %}bg-green-100 border border-green-300{% elif selected_stock.indicators.rsi < 50 %}bg-blue-100 border border-blue-300{% elif selected_stock.indicators.rsi < 70 %}bg-yellow-100 border border-yellow-300{% else %}bg-red-100 border border-red-300{% endif %}">
                    <span class="text-sm font-semibold {% if selected_stock.indicators.rsi < 35 %}text-green-700{% elif selected_stock.indicators.rsi < 50 %}text-blue-700{% elif selected_stock.indicators.rsi < 70 %}text-yellow-700{% else %}text-red-700{% endif %}">
                        {% if selected_stock.indicators.rsi < 35 %}‚úÖ EXCELLENT CSP ENTRY
                        {% elif selected_stock.indicators.rsi < 50 %}üëç GOOD CSP ENTRY
                        {% elif selected_stock.indicators.rsi < 70 %}‚è≥ WAIT FOR DIP
                        {% else %}‚õî AVOID - OVERBOUGHT
                        {% endif %}
                    </span>
                    <span class="text-xs {% if selected_stock.indicators.rsi < 35 %}text-green-600{% elif selected_stock.indicators.rsi < 50 %}text-blue-600{% elif selected_stock.indicators.rsi < 70 %}text-yellow-600{% else %}text-red-600{% endif %}">
                        RSI {{ selected_stock.indicators.rsi|floatformat:0 }}
                    </span>
                </div>
                {% endif %}
            </div>
            
            <div class="text-right">
                <div class="text-xs text-gray-600 mb-1">Current Price</div>
                <div class="text-3xl font-bold text-blue-600">${{ selected_stock.last_price|floatformat:2 }}</div>
                
                {% if selected_stock.indicators %}
                <div class="mt-2 text-xs text-gray-600 space-y-1">
                    {% if selected_stock.indicators.ema_trend %}
                    <div>Trend: <span class="font-semibold {% if selected_stock.indicators.ema_trend == 'BULLISH' %}text-green-600{% elif selected_stock.indicators.ema_trend == 'BEARISH' %}text-red-600{% else %}text-yellow-600{% endif %}">{{ selected_stock.indicators.ema_trend }}</span></div>
                    {% endif %}
                    {% if selected_stock.indicators.support_level_1 %}
                    <div>Support: <span class="font-semibold">${{ selected_stock.indicators.support_level_1|floatformat:2 }}</span></div>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    {% if options %}
    <!-- Results Summary with Tabs -->
    <div class="bg-white rounded-lg border border-gray-200 mb-4">
        <!-- Tab Navigation -->
        <div class="flex border-b border-gray-200">
            <button onclick="showOptionsType('puts')" id="tab-puts" class="options-type-tab flex-1 px-6 py-3 font-semibold text-sm transition-all border-b-2 border-red-500 bg-red-50 text-red-700">
                üìâ PUTS
                <span id="puts-count" class="ml-2 px-2 py-0.5 rounded-full bg-red-200 text-red-800 text-xs font-bold">0</span>
            </button>
            <button onclick="showOptionsType('calls')" id="tab-calls" class="options-type-tab flex-1 px-6 py-3 font-semibold text-sm transition-all border-b-2 border-transparent hover:bg-gray-50 text-gray-600">
                üìà CALLS
                <span id="calls-count" class="ml-2 px-2 py-0.5 rounded-full bg-gray-200 text-gray-700 text-xs font-bold">0</span>
            </button>
            <button onclick="showOptionsType('all')" id="tab-all" class="options-type-tab flex-1 px-6 py-3 font-semibold text-sm transition-all border-b-2 border-transparent hover:bg-gray-50 text-gray-600">
                üìä ALL
                <span id="all-count" class="ml-2 px-2 py-0.5 rounded-full bg-gray-200 text-gray-700 text-xs font-bold">{{ options|length }}</span>
            </button>
        </div>
        
        <!-- Filter Info Bar -->
        <div class="bg-blue-50 px-6 py-3 border-b border-blue-200">
            <div class="flex items-center justify-between text-sm">
                <span class="text-gray-700">
                    <strong id="visible-count">{{ options|length }}</strong> option{{ options|length|pluralize }} displayed
                    {% if request.GET.dte_filter == 'weekly' or not request.GET.dte_filter %}
                    <span class="text-blue-600 font-semibold ml-2">‚≠ê Weekly Strategy (7-14 DTE)</span>
                    {% endif %}
                </span>
                <span class="text-gray-600">
                    üí° <span id="strategy-hint">Focus on PUTs with delta 0.20-0.40 for wheel strategy</span>
                </span>
            </div>
        </div>
    </div>
    
    <!-- Options Table -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
                        <div class="flex items-center gap-1">
                            Type
                            <span class="group relative inline-flex">
                                <span class="inline-flex items-center justify-center w-4 h-4 text-[10px] font-bold text-gray-600 bg-gray-200 rounded-full cursor-help">i</span>
                                <span class="fixed left-1/2 -translate-x-1/2 -translate-y-full hidden group-hover:block w-48 px-2 py-1 text-xs text-white bg-gray-900 rounded-lg shadow-2xl z-[99999]">
                                    PUT = Sell to collect premium. Goal: expire worthless or get assigned at good price.
                                </span>
                            </span>
                        </div>
                    </th>
                    <th class="px-4 py-3 text-right text-xs font-medium text-gray-700 uppercase tracking-wider">
                        <div class="flex items-center justify-end gap-1">
                            Strike
                            <span class="group relative inline-flex">
                                <span class="inline-flex items-center justify-center w-4 h-4 text-[10px] font-bold text-gray-600 bg-gray-200 rounded-full cursor-help">i</span>
                                <span class="fixed left-1/2 -translate-x-1/2 -translate-y-full hidden group-hover:block w-52 px-2 py-1 text-xs text-white bg-gray-900 rounded-lg shadow-2xl z-[99999]">
                                    Price you'd buy stock at if assigned. Choose near support level for best entries.
                                </span>
                            </span>
                        </div>
                    </th>
                    <th class="px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase tracking-wider">
                        <div class="flex items-center justify-center gap-1">
                            Expiry / DTE
                            <span class="group relative inline-flex">
                                <span class="inline-flex items-center justify-center w-4 h-4 text-[10px] font-bold text-gray-600 bg-gray-200 rounded-full cursor-help">i</span>
                                <span class="fixed left-1/2 -translate-x-1/2 -translate-y-full hidden group-hover:block w-48 px-2 py-1 text-xs text-white bg-gray-900 rounded-lg shadow-2xl z-[99999]">
                                    Days To Expiration. Weekly Wheel Strategy: 7-14 DTE optimal for theta decay.
                                </span>
                            </span>
                        </div>
                    </th>
                    <th class="px-4 py-3 text-right text-xs font-medium text-gray-700 uppercase tracking-wider">Premium</th>
                    <th class="px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase tracking-wider">
                        <div class="flex items-center justify-center gap-1">
                            Delta
                            <span class="group relative inline-flex">
                                <span class="inline-flex items-center justify-center w-4 h-4 text-[10px] font-bold text-gray-600 bg-gray-200 rounded-full cursor-help">i</span>
                                <span class="fixed left-1/2 -translate-x-1/2 -translate-y-full hidden group-hover:block w-52 px-2 py-1 text-xs text-white bg-gray-900 rounded-lg shadow-2xl z-[99999]">
                                    Probability of assignment. 0.30 delta = ~30% chance. Target 0.20-0.40 for wheel strategy.
                                </span>
                            </span>
                        </div>
                    </th>
                    <th class="px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase tracking-wider">
                        <div class="flex items-center justify-center gap-1">
                            APY
                            <span class="group relative inline-flex">
                                <span class="inline-flex items-center justify-center w-4 h-4 text-[10px] font-bold text-gray-600 bg-gray-200 rounded-full cursor-help">i</span>
                                <span class="fixed left-1/2 -translate-x-1/2 -translate-y-full hidden group-hover:block w-52 px-2 py-1 text-xs text-white bg-gray-900 rounded-lg shadow-2xl z-[99999]">
                                    Annualized return if you sell this put. 30%+ APY = excellent. Formula: (Premium/Strike) √ó (365/DTE) √ó 100
                                </span>
                            </span>
                        </div>
                    </th>
                    <th class="px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase tracking-wider">IV</th>
                    <th class="px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase tracking-wider">
                        <div class="flex items-center justify-center gap-1">
                            Wheel Rating
                            <span class="group relative inline-flex">
                                <span class="inline-flex items-center justify-center w-4 h-4 text-[10px] font-bold text-gray-600 bg-gray-200 rounded-full cursor-help">i</span>
                                <span class="fixed left-1/2 -translate-x-1/2 -translate-y-full hidden group-hover:block w-56 px-2 py-1 text-xs text-white bg-gray-900 rounded-lg shadow-2xl z-[99999]">
                                    Overall quality for Weekly Wheel Strategy. EXCELLENT = RSI < 35, weekly DTE, high APY, good delta.
                                </span>
                            </span>
                        </div>
                    </th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                {% for option in options %}
                <tr class="option-row hover:bg-gray-50 transition-colors {% if option.days_to_expiration >= 7 and option.days_to_expiration <= 14 %}bg-blue-50{% endif %}" 
                    data-option-type="{{ option.option_type }}"
                    data-dte="{{ option.days_to_expiration }}"
                    data-strike="{{ option.strike }}">

                    {# Column 1: Type #}
                    <td class="px-4 py-4">
                        <div class="flex items-center gap-2">
                            <span class="px-3 py-1.5 rounded-lg text-sm font-bold shadow-sm
                                {% if option.option_type == 'PUT' %}bg-gradient-to-br from-red-500 to-red-600 text-white
                                {% else %}bg-gradient-to-br from-green-500 to-green-600 text-white{% endif %}">
                                {{ option.option_type }}
                            </span>
                            {% if option.option_type == 'PUT' and option.strike < selected_stock.last_price %}
                                <span class="text-xs px-2 py-0.5 rounded bg-blue-100 text-blue-700 font-semibold">OTM</span>
                            {% elif option.option_type == 'CALL' and option.strike > selected_stock.last_price %}
                                <span class="text-xs px-2 py-0.5 rounded bg-blue-100 text-blue-700 font-semibold">OTM</span>
                            {% else %}
                                <span class="text-xs px-2 py-0.5 rounded bg-red-100 text-red-700 font-semibold">ITM</span>
                            {% endif %}
                        </div>
                    </td>

                    {# Column 2: Strike #}
                    <td class="px-4 py-4 text-right">
                        <div class="text-lg font-bold text-gray-900">${{ option.strike|floatformat:2 }}</div>
                        {% if selected_stock.last_price %}
                        {% with diff=option.strike|sub:selected_stock.last_price %}
                        <div class="text-xs mt-1 {% if diff < 0 %}text-green-600{% else %}text-red-600{% endif %}">
                            {% if diff < 0 %}‚ñº{% else %}‚ñ≤{% endif %} ${{ diff|abs_value|floatformat:2 }}
                        </div>
                        {% endwith %}
                        {% endif %}
                    </td>

                    {# Column 3: Expiry / DTE #}
                    <td class="px-4 py-4 text-center">
                        <div class="text-sm font-semibold text-gray-900">{{ option.expiry_date|date:"M d, Y" }}</div>
                        <div class="inline-flex items-center gap-1 px-2.5 py-1 rounded-lg text-xs font-bold shadow-sm mt-1
                            {% if option.days_to_expiration >= 7 and option.days_to_expiration <= 14 %}bg-gradient-to-r from-green-500 to-green-600 text-white
                            {% elif option.days_to_expiration < 7 %}bg-gradient-to-r from-orange-500 to-orange-600 text-white
                            {% else %}bg-gray-200 text-gray-700{% endif %}">
                            {% if option.days_to_expiration >= 7 and option.days_to_expiration <= 14 %}‚≠ê {% endif %}
                            {{ option.days_to_expiration }} DTE
                        </div>
                    </td>

                    {# Column 4: Premium #}
                    <td class="px-4 py-4 text-right">
                        {% if option.mid_price %}
                        <div class="font-bold text-xl text-purple-600">${{ option.mid_price|floatformat:2 }}</div>
                        <div class="text-xs text-gray-500 font-medium mt-1">
                            <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded bg-purple-100 text-purple-700">
                                üí∞ ${{ option.mid_price|mul:100|floatformat:0|intcomma }}/contract
                            </span>
                        </div>
                        {% else %}
                        <span class="text-gray-400 text-lg">-</span>
                        {% endif %}
                    </td>

                    {# Column 5: Delta #}
                    <td class="px-4 py-4 text-center">
                        {% if option.delta %}
                        <div class="inline-flex px-3 py-1.5 rounded-lg text-sm font-bold shadow-sm
                            {% if option.option_type == 'PUT' %}
                                {% if option.delta >= -0.40 and option.delta <= -0.20 %}bg-green-100 text-green-700 border-2 border-green-400 ring-2 ring-green-200
                                {% elif option.delta > -0.50 and option.delta < -0.10 %}bg-blue-100 text-blue-700 border border-blue-300
                                {% else %}bg-gray-100 text-gray-700{% endif %}
                            {% else %}
                                {% if option.delta >= 0.20 and option.delta <= 0.40 %}bg-green-100 text-green-700 border-2 border-green-400 ring-2 ring-green-200
                                {% elif option.delta > 0.10 and option.delta < 0.50 %}bg-blue-100 text-blue-700 border border-blue-300
                                {% else %}bg-gray-100 text-gray-700{% endif %}
                            {% endif %}">
                            {{ option.delta|floatformat:2 }}
                        </div>
                        <div class="text-xs text-gray-500 mt-1">~{{ option.delta|abs_value|mul:100|floatformat:0 }}% prob</div>
                        {% else %}
                        <span class="text-gray-400">-</span>
                        {% endif %}
                    </td>

                    {# Column 6: APY #}
                    <td class="px-4 py-4 text-center">
                        {% if option.mid_price and option.strike and option.days_to_expiration %}
                        {% with strike_dte=option.strike|stringformat:"s"|add:","|add:option.days_to_expiration|stringformat:"s" %}
                        {% with apy=option.mid_price|apy_from_premium:strike_dte %}
                        <div class="font-bold text-xl {% if apy >= 50 %}text-green-600{% elif apy >= 30 %}text-blue-600{% elif apy >= 20 %}text-yellow-600{% else %}text-gray-600{% endif %}">
                            {{ apy|floatformat:1 }}%
                        </div>
                        <div class="text-xs text-gray-500 font-medium mt-1">
                            {% if apy >= 50 %}üî• Excellent
                            {% elif apy >= 30 %}üëç Good
                            {% elif apy >= 20 %}üëå Fair
                            {% else %}üí§ Low
                            {% endif %}
                        </div>
                        {% endwith %}
                        {% endwith %}
                        {% else %}
                        <span class="text-gray-400">-</span>
                        {% endif %}
                    </td>

                    {# Column 7: IV #}
                    <td class="px-4 py-4 text-center">
                        {% if option.implied_volatility %}
                        <span class="text-sm font-bold text-gray-900">{{ option.implied_volatility|mul:100|floatformat:1 }}%</span>
                        <div class="text-xs text-gray-500 mt-1">
                            {% if option.implied_volatility > 0.6 %}Very High
                            {% elif option.implied_volatility > 0.4 %}High
                            {% elif option.implied_volatility > 0.25 %}Moderate
                            {% else %}Low
                            {% endif %}
                        </div>
                        {% else %}
                        <span class="text-gray-400">-</span>
                        {% endif %}
                    </td>

                    {# Column 8: Wheel Rating #}
                    <td class="px-4 py-4 text-center">
                        {% if option.option_type == 'PUT' and option.days_to_expiration and option.delta and option.mid_price and option.strike %}
                            {% with strike_dte=option.strike|stringformat:"s"|add:","|add:option.days_to_expiration|stringformat:"s" %}
                            {% with apy=option.mid_price|apy_from_premium:strike_dte %}
                            {% if option.days_to_expiration >= 7 and option.days_to_expiration <= 14 and option.delta >= -0.40 and option.delta <= -0.20 and apy >= 30 and selected_stock.indicators.rsi < 35 %}
                                <span class="inline-flex items-center gap-1 px-3 py-1.5 rounded-lg text-xs font-bold bg-gradient-to-r from-green-500 to-green-600 text-white shadow-md">
                                    ‚≠ê EXCELLENT
                                </span>
                            {% elif option.days_to_expiration >= 7 and option.days_to_expiration <= 14 and apy >= 20 %}
                                <span class="px-3 py-1.5 rounded-lg text-xs font-bold bg-gradient-to-r from-blue-500 to-blue-600 text-white shadow-sm">
                                    GOOD
                                </span>
                            {% elif option.days_to_expiration <= 30 and apy >= 15 %}
                                <span class="px-3 py-1.5 rounded-lg text-xs font-semibold bg-yellow-100 text-yellow-800">
                                    FAIR
                                </span>
                            {% else %}
                                <span class="px-3 py-1.5 rounded-lg text-xs text-gray-600 bg-gray-100">
                                    OK
                                </span>
                            {% endif %}
                            {% endwith %}
                            {% endwith %}
                        {% elif option.option_type == 'CALL' %}
                            <span class="px-3 py-1.5 rounded-lg text-xs font-semibold bg-green-100 text-green-700">
                                {% if option.days_to_expiration >= 7 and option.days_to_expiration <= 14 %}‚≠ê {% endif %}CALL
                            </span>
                        {% else %}
                            <span class="text-gray-400">-</span>
                        {% endif %}
                    </td>

                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <script>
    // Count options by type on page load
    document.addEventListener('DOMContentLoaded', function() {
        updateOptionCounts();
        // Show puts by default for wheel strategy
        showOptionsType('puts');
    });
    
    function updateOptionCounts() {
        const allRows = document.querySelectorAll('.option-row');
        const putRows = document.querySelectorAll('.option-row[data-option-type="PUT"]');
        const callRows = document.querySelectorAll('.option-row[data-option-type="CALL"]');
        
        document.getElementById('puts-count').textContent = putRows.length;
        document.getElementById('calls-count').textContent = callRows.length;
        document.getElementById('all-count').textContent = allRows.length;
    }
    
    function showOptionsType(type) {
        const allRows = document.querySelectorAll('.option-row');
        const tabButtons = document.querySelectorAll('.options-type-tab');
        let visibleCount = 0;
        
        // Update rows visibility
        allRows.forEach(row => {
            const optionType = row.getAttribute('data-option-type');
            if (type === 'all') {
                row.style.display = '';
                visibleCount++;
            } else if (type === 'puts' && optionType === 'PUT') {
                row.style.display = '';
                visibleCount++;
            } else if (type === 'calls' && optionType === 'CALL') {
                row.style.display = '';
                visibleCount++;
            } else {
                row.style.display = 'none';
            }
        });
        
        // Update tab button styles
        tabButtons.forEach(btn => {
            btn.classList.remove('border-red-500', 'bg-red-50', 'text-red-700');
            btn.classList.remove('border-green-500', 'bg-green-50', 'text-green-700');
            btn.classList.remove('border-blue-500', 'bg-blue-50', 'text-blue-700');
            btn.classList.add('border-transparent', 'text-gray-600');
        });
        
        // Highlight active tab
        const activeTab = document.getElementById('tab-' + type);
        if (activeTab) {
            activeTab.classList.remove('border-transparent', 'text-gray-600');
            if (type === 'puts') {
                activeTab.classList.add('border-red-500', 'bg-red-50', 'text-red-700');
            } else if (type === 'calls') {
                activeTab.classList.add('border-green-500', 'bg-green-50', 'text-green-700');
            } else {
                activeTab.classList.add('border-blue-500', 'bg-blue-50', 'text-blue-700');
            }
        }
        
        // Update visible count
        document.getElementById('visible-count').textContent = visibleCount;
        
        // Update strategy hint
        const hintElement = document.getElementById('strategy-hint');
        if (type === 'puts') {
            hintElement.textContent = 'Focus on PUTs with delta 0.20-0.40 for wheel strategy';
        } else if (type === 'calls') {
            hintElement.textContent = 'Sell covered CALLs if assigned - target OTM strikes for best results';
        } else {
            hintElement.textContent = 'PUTs for income, CALLs if assigned - complete wheel strategy';
        }
    }
    </script>
    {% else %}
    <div class="bg-white rounded-lg border border-gray-200 p-8 text-center">
        <div class="text-4xl mb-3">üìä</div>
        <p class="text-gray-600">No options data available for {{ selected_stock.ticker }}</p>
        <p class="text-sm text-gray-500 mt-2">Try syncing options data or select another stock</p>
    </div>
    {% endif %}
    
    {% else %}
    <!-- No Stock Selected -->
    <div class="bg-white rounded-lg border border-gray-200 p-12 text-center">
        <div class="text-6xl mb-4">üìä</div>
        <h3 class="text-lg font-medium text-gray-900 mb-2">Select a Stock</h3>
        <p class="text-gray-500">Choose a stock from the dropdown above to view its options chain</p>
    </div>
    {% endif %}
</div>
