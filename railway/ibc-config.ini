# IBC Configuration for IB Gateway on Railway
# This file is used as a template — envsubst replaces ${TRADING_MODE} and ${READ_ONLY_API}
# Credentials are passed via command-line args (--user/--pw), not this file

# 1. IBC Startup Settings
FIX=no

# 2. Authentication Settings
# Login credentials are passed via CLI args from TWS_USERID/TWS_PASSWORD env vars
# Leave empty here — IBC CLI args take precedence
IbLoginId=
IbPassword=

# Second Factor Authentication
# Wait for user to complete 2FA manually — do NOT restart or exit
SecondFactorDevice=
ExitAfterSecondFactorAuthenticationTimeout=no
SecondFactorAuthenticationExitInterval=600

# Trading Mode (templated from TRADING_MODE env var)
TradingMode=${TRADING_MODE}

# Paper-trading warning auto-accept
AcceptNonBrokerageAccountWarning=yes

# Login Dialog Display Timeout (increased for Railway cold starts)
LoginDialogDisplayTimeout=180

# 3. TWS Startup Settings
IbDir=/root/Jts
StoreSettingsOnServer=
MinimizeMainWindow=no
ExistingSessionDetectedAction=primary

# Override API port to 4001 so Django can connect on a known port
OverrideTwsApiPort=4001

# Read-only Login
ReadOnlyLogin=no

# Read-only API (templated from READ_ONLY_API env var)
ReadOnlyApi=${READ_ONLY_API}

# Market data size notification
AcceptBidAskLastSizeDisplayUpdateNotification=accept
SendMarketDataInLotsForUSstocks=

# 4. TWS Auto-Closedown
IbAutoClosedown=yes
ClosedownAt=

# 6. Other TWS Settings
# Accept incoming API connections (allow Django to connect)
AcceptIncomingConnectionAction=accept
AllowBlindTrading=yes
DismissPasswordExpiryWarning=yes
DismissNSEComplianceNotice=yes

# Save settings periodically
SaveTwsSettingsAt=

# 8. IBC Command Server (disabled)
#CommandServerPort=7462
ControlFrom=
BindAddress=
CommandPrompt=
SuppressInfoMessages=yes

# 9. Diagnostic Settings
LogStructureScope=known
LogStructureWhen=never
